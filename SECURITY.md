# セキュリティ対策

このアプリケーションは、APIキーの漏洩を防ぐために複数のセキュリティ対策を実装しています。

## 🔒 実装されているセキュリティ対策

### 1. APIキーの完全保護
- **環境変数**: APIキーは`.env`ファイルで管理
- **Git除外**: `.gitignore`でAPIキーを含むファイルを除外
- **サーバーサイド**: APIキーはサーバーサイドでのみ使用
- **プロキシパターン**: クライアントは直接APIを呼ばず、サーバーを経由

### 2. レート制限
- **クライアント**: 1分間に10リクエストまで
- **サーバー**: IPアドレスベースの制限
- **自動復旧**: 制限時間経過後に自動的に復旧

### 3. 入力検証
- **文字数制限**: 5000文字まで
- **型チェック**: 入力データの型を検証
- **サニタイゼーション**: 不正な入力をブロック

### 4. HTTPセキュリティ
- **CORS設定**: 適切なOrigin制御
- **セキュリティヘッダー**: XSS、CSRF対策
- **Content-Type検証**: 適切なMIMEタイプのみ受付

### 5. エラーハンドリング
- **情報漏洩防止**: 詳細なエラー情報を隠蔽
- **ユーザーフレンドリー**: 分かりやすいエラーメッセージ
- **ログ記録**: サーバーサイドでのエラー追跡

## ⚠️ 重要な注意事項

### 絶対にしてはいけないこと
1. **APIキーをGitにコミット** - `.env`ファイルは絶対にコミットしない
2. **クライアントサイドにAPIキー** - フロントエンドにAPIキーを埋め込まない
3. **HTTPでの運用** - 本番環境では必ずHTTPSを使用
4. **エラー情報の詳細表示** - 本番環境でスタックトレースを表示しない

### 推奨される追加対策
1. **API キーの定期的な更新**
2. **アクセスログの監視**
3. **SSL/TLS証明書の適切な設定**
4. **WAF (Web Application Firewall) の導入**
5. **定期的なセキュリティ監査**

## 📋 デプロイ前チェックリスト

- [ ] `.env`ファイルが`.gitignore`に含まれている
- [ ] APIキーが環境変数として設定されている
- [ ] 本番環境でHTTPSが有効
- [ ] レート制限が適切に設定されている
- [ ] エラーハンドリングが適切に実装されている
- [ ] セキュリティヘッダーが設定されている
- [ ] 不要なデバッグ情報が削除されている

## 🚨 セキュリティインシデント対応

APIキーが漏洩した場合の対応手順：

1. **即座にAPIキーを無効化**
   - Google AI Studioでキーを削除
2. **新しいAPIキーを生成**
   - 新しいキーを環境変数に設定
3. **アクセスログを確認**
   - 不正使用がないか確認
4. **システムの再デプロイ**
   - 新しいキーでアプリケーションを再起動

## 📞 連絡先

セキュリティに関する問題を発見した場合は、すぐに開発チームに連絡してください。